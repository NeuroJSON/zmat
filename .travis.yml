language: c

compiler:
  - gcc

jobs:
  include:
    - os: linux
      name: Ubuntu 14.04
      dist: trusty
      env:
      - BADGE=Ubuntu_14.04
      - MAKE=make
    - os: linux
      name: Ubuntu 16.04
      dist: xenial
      env:
      - BADGE=Ubuntu_16.04
      - MAKE=make
    - os: linux
      name: Ubuntu 18.04
      dist: bionic
      env:
      - BADGE=Ubuntu_18.04
      - MAKE=make
    - os: linux
      name: Ubuntu 20.04
      dist: focal
      env:
      - BADGE=Ubuntu_20.04
      - MAKE=make
    - os: linux
      name: Ubuntu 22.04
      dist: jammy
      env:
      - BADGE=Ubuntu_22.04
      - MAKE=make
    - os: windows
      name: Windows
      env:
      - BADGE=Windows
      - MAKE=mingw32-make
    - os: osx
      name: OSX
      env:
      - BADGE=OSX
      - MAKE=make

before_install:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install liboctave-dev; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install qt octave findutils gcc; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then
        choco install octave.portable --version=5.2.0;
        export PATH=${PATH}:"C:\ProgramData\chocolatey\lib\octave.portable\tools\octave\bin";
        ls "C:\ProgramData\chocolatey\lib\octave.portable\tools\octave\bin";
        mkoctfile --version;
        octave-cli --version;
    fi

addons:
  apt:
    packages:
    - liboctave-dev
    update: true

script:
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
         octave-cli --eval "addpath(pwd);cd example;demo_zmat_basic";
      fi
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
         octave-cli --eval "addpath(pwd);cd example;demo_zmat_basic";
      fi
    - ${MAKE} -C src lib
    - ${MAKE} -C src dll USERLINKOPT="-lz"
    - ${MAKE} -C src oct;
    - octave-cli --eval "addpath(pwd);cd example;demo_zmat_basic";

